___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Conferwith Tracking",
  "categories": [
    "ATTRIBUTION"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "ConferWith",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "The Conferwith Tracking Tags are used to track online shopper activities in the ecommerce site which use conferwith app",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "eventType",
    "displayName": "Event Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "startCall",
        "displayValue": "Start Call"
      },
      {
        "value": "addToBasket",
        "displayValue": "Add to Basket"
      },
      {
        "value": "share",
        "displayValue": "Share"
      },
      {
        "value": "checkout",
        "displayValue": "Checkout"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "startCall",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const callInWindow = require('callInWindow');
const copyFromWindow = require('copyFromWindow');
const log = require('logToConsole');
const setInWindow = require('setInWindow');
const injectScript = require('injectScript');
const dataLayer = require('copyFromDataLayer');
const localStorage = require('localStorage');

const sendRequest = copyFromWindow('sendRequest');

const sessionId =  dataLayer('sessionId');
const products = dataLayer('products');
const eventType = data.eventType;
const store = dataLayer('store');
const product = dataLayer('product');
const actor = dataLayer('actor');
const serverUrl = localStorage.getItem('serverUrl');
const checkoutId =  dataLayer('checkoutId');
const action =  dataLayer('action');
const label = dataLayer('label');
const logData = dataLayer('data');
const description = dataLayer('description');

const trackObject = (function() {
  if(eventType == 'checkout'){
    return {        
        store: store,
        sessionId: sessionId,
        checkoutId:checkoutId,
        products: products,
        trackingFrom: 'GTM'
      };
  } else 
      return {
        action: action,  
        label: 'GTM_'+ label,
        store: store,
        sessionId: sessionId,
        actor: actor,
        description: description,
        data: data
      };
  } 
)();

log('data:'+ trackObject);

const onSuccess = () => {
  log('Script loaded successfully.');

if (trackObject && serverUrl) {
  if(eventType == 'checkout') {
    callInWindow('sendRequest', serverUrl+'/api/checkout', trackObject);
  } else {
    callInWindow('sendRequest', serverUrl+'/api/activity', trackObject);
  }
  
}
  
  data.gtmOnSuccess();
};

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  log('Script load failed.');
  data.gtmOnFailure();
};

injectScript('https://instore-expert-dev.site/public/videos/postReq.js', onSuccess, onFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sendRequest"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://instore-expert-dev.site/public/videos/postReq.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "sessionId"
              },
              {
                "type": 1,
                "string": "products"
              },
              {
                "type": 1,
                "string": "eventType"
              },
              {
                "type": 1,
                "string": "store"
              },
              {
                "type": 1,
                "string": "product"
              },
              {
                "type": 1,
                "string": "actor"
              },
              {
                "type": 1,
                "string": "serverUrl"
              },
              {
                "type": 1,
                "string": "checkoutId"
              },
              {
                "type": 1,
                "string": "action"
              },
              {
                "type": 1,
                "string": "label"
              },
              {
                "type": 1,
                "string": "data"
              },
              {
                "type": 1,
                "string": "description"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_local_storage",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "serverUrl"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 27/03/2020, 11:11:48


